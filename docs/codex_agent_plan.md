# Codex連携オートメーション - Slashコマンド設計プラン

## ゴール
- `codex_agent_tasks.md` における最優先タスク「Slash コマンド設計」を完了し、レビュー可能な仕様書を確定する。
- 仕様書はコマンド一覧・引数・レスポンス・権限制御・エラーハンドリング・シーケンスフローを網羅し、実装チームが Phase 2 以降に着手できる状態にする。

## 成果物
1. Slash コマンド仕様書（Markdown）
   - `/task create`, `/task list`, `/work start`, `/work status`, `/work cancel` など必須コマンドの振る舞い。
   - 引数（必須 / 任意）、型、バリデーションルール、Slash コマンド UI 上での入力設計。
   - Bot 応答メッセージのテンプレート（成功 / 失敗 / 進行中）。
   - 利用ロール・権限要件、レートリミット、危険コマンド対策。
   - CLI 実行結果との連携フォーマット（Task.md / Plans.md 更新内容の扱い）。
2. ワークフロー図およびステート遷移表（任意だが推奨）。
3. レビュー向けチェックリスト（依頼者との確認項目、未確定事項）。

## 作業ステップ
1. **現状整理**
   - 既存の Task/Plans 運用ルールと Codex CLI の入出力形式を調査。
   - Discord Slash コマンドの利用制約（テキスト長、モーダル、添付ファイル対応など）を確認。
2. **要件ヒアリング**
   - 想定ユーザー（依頼者・オペレータ）の利用シナリオを列挙し、必須コマンドと Nice-to-have を分類。
   - エラーパターンや人手介入が必要なケース（権限不足、危険な依頼）を洗い出す。
3. **コマンド仕様ドラフト作成**
   - 各コマンドの Slash UI、引数、バリデーション、レスポンス例を記載。
   - メタデータ（依頼者、チャンネル、タイムスタンプ等）の保存フォーマットを仕様書に含める。
   - CLI 呼び出し時に必要なパラメータや環境変数の引き渡し方法を整理。
4. **セキュリティ・運用観点の統合**
   - 権限管理、危険ワードフィルタ、実行可能コマンドの制限方針を仕様化。
   - ログ出力と監査の要件（保存期間、閲覧可能者）を記載。
5. **レビュー準備とフィードバック反映**
   - レビューア向けチェックリストを付属し、不明点・決定待ち項目を明示。
   - フィードバックを反映し、最終版をドキュメント化（リポジトリの `docs/` 配下に保存）。

## タイムライン（目安）
- Day 0-1: 現状整理・制約確認
- Day 2: 要件ヒアリングまとめ
- Day 3: 仕様ドラフト作成
- Day 4: セキュリティ・運用項目追加
- Day 5: レビュー依頼・フィードバック反映

## 依存関係 / 前提
- Codex CLI の現行仕様書・入出力例が参照可能であること。
- Discord Bot の Slash コマンド開発ガイドライン（Rate Limit / パーミッション設定）が入手できること。
- タスク保存先（例: `tasks/inbox/`）の設計方針が大枠で合意済みであること。

## リスクと対応
- **要件ブレ**: 初期ヒアリングでユースケースと優先度を明確化し、Nice-to-have を別表管理。
- **セキュリティ懸念の後出し**: レビュー前にセキュリティ担当者へドラフト共有し、チェックリストで確認。
- **CLI 側インターフェース変更**: 変更が入った際に仕様書の連携項目（出力フォーマット等）を即座に更新できるよう、連絡窓口を決める。

## 次アクション
1. 現状整理のため、既存 Task/Plans 運用ドキュメントを収集する。
2. 想定ユーザーへのヒアリング（または要件アンケート）項目を準備し、スケジュールを確定する。
3. ドラフト執筆用のテンプレート（Markdown）を `docs/` 配下に作成する。
