# Nyaimlab 次期対応計画

## 現状サマリ
- Slashコマンド実装（`/verify post`, `/roles post`, `/introduce` など）と監査ログ基盤は完了済み。
- Python製 ESCL コレクタは CSV / Excel 両対応し、Node.js ランタイムから CLI 経由で再利用できる状態。
- React ダッシュボードは主要タブと PR 起票フローまで実装済み。
- FastAPI 管理APIは全主要エンドポイントを提供するが、インメモリ運用に留まっている。

## 直近の進捗
- Verifyロール剥奪・メンバー退会時の監査ログを実装（`guildMemberRemove`／`guildMemberUpdate`フック追加、`verify.revoke`および`member.leave`記録）。
- Python ESCL コマンドを CLI 化し、Node.js ランタイムで `/version` / `/escl_from_parent_csv` / `/escl_from_parent_xlsx` を統合。

## 優先課題（短期）
1. **スクリム補助ワークフロー設計・Bot連携**  
   - ダッシュボード設定→Bot実行までのデータモデル定義。  
   - スクリム通知・ドライラン結果のDiscord連携を具体化。
2. **Introduceモーダル拡張**  
   - セレクト項目・NGワード検証・添付ファイル対応の仕様確定。  
   - Bot側のバリデーションとEmbed整形を設計。
3. **Botヘルスチェック整備**  
   - 起動時の権限検査（必要ロール／パーミッションの確認）。  
   - Slashコマンド同期失敗などの障害検知フローを整理。

## 中期課題（バックエンド・フロントエンド）
- **管理APIの永続化**  
  - ストレージ層（例: SQLite/Postgres/Firestore）を導入し、再起動時に設定が保持されるようにする。  
  - 監査ログの長期保存・検索性向上を検討。
- **Webhook／外部通知連携**  
  - Bot更新や設定変更をGitHub/Discordに通知するインターフェースを追加。  
  - 将来的なCI連携や自動PRマージ通知の下準備。
- **ダッシュボードIntroduceフォーム強化**  
  - セレクトUI、NGワード一覧、添付許可トグルなどを追加。  
  - 入力値のバリデーションとプレビュー強化（差分チェック／警告表示）。
- **入力バリデーションと差分プレビュー高度化**  
  - 各タブの必須項目チェック結果を集約表示。  
  - YAML生成前のコンシステンシーチェックを追加。

## インフラ／運用タスク
- **Secrets・権限運用ガイド整備**  
  - Botトークン、APIトークン、GitHub PATの保管ポリシーと権限範囲を文書化。  
  - Rotational手順と事故対応フローを定義。
- **Welcome／Verify／Roles 文言最終レビュー**  
  - 本番向けメッセージ原稿を確定し、ダッシュボードに反映する。  
  - 多言語化の要否と将来計画を検討。
- **テストギルドでのE2E検証手順書**  
  - Slashコマンド実行→監査ログ確認→設定反映の手順を標準化。  
  - 失敗時のトラブルシューティング（権限不足、APIエラー等）を網羅。
- **ダッシュボードAPIとGitHub同期自動化の検討**  
  - Webhookやスケジューラを用いた設定反映の自動化案を評価。  
  - 手動PRフローとの共存方法を整理。

## 進行管理メモ
- スクリム補助とIntroduce拡張は仕様依存度が高いため、先に要件策定ワークショップを開催する。  
- バックエンド永続化とWebhook連携はAPIの互換性変更を伴うため、バージョン管理方針を決めてから着手する。  
- インフラ文書化とE2E手順は、次回リリースまでにドラフト版を準備してレビューを受ける。
